/*
 * jQuery Guillotine Plugin v1.1.0
 * http://matiasgagliano.github.com/guillotine/
 *
 * Copyright 2014, Mat√≠as Gagliano.
 * Dual licensed under the MIT or GPLv3 licenses.
 * http://opensource.org/licenses/MIT
 * http://opensource.org/licenses/GPL-3.0
 *
 */

(function(){"use strict";var t,i,e,h,s,n,o,r,a,l,u,d,f=[].indexOf||function(t){for(var i=0,e=this.length;i<e;i++){if(i in this&&this[i]===t)return i}return-1},c=function(t,i){return function(){return t.apply(i,arguments)}};t=jQuery;l="guillotine";u="guillotine";s={start:"MSPointerDown."+u+" touchstart."+u+" mousedown."+u,move:"MSPointerMove."+u+" touchmove."+u+" mousemove."+u,stop:"MSPointerUp."+u+" touchend."+u+" mouseup."+u};h={width:400,height:300,zoomStep:.1,eventOnChange:null,onChange:null};a=function(t){return t.type.search("touch")>-1};r=function(){return f.call(window,"MSPointerEvent")>=0};d=function(t){if(r()||!a(t)){d=function(t){return t.which!=null&&t.which===1}}else{d=function(){var i,e;return((i=t.originalEvent)!=null?(e=i.touches)!=null?e.length:void 0:void 0)===1}}return d(t)};n=function(t){if(r()||!a(t)){n=function(t){return{x:t.pageX,y:t.pageY}}}else{n=function(t){t=t.originalEvent.touches[0];return{x:t.pageX,y:t.pageY}}}return n(t)};e=function(){var t,i,h,s,n,o,r,a,l,u;t=false;s="webkit,Moz,O,ms,Khtml".split(",");r={transform:"transform"};for(l=0,u=s.length;l<u;l++){h=s[l];r[h+"Transform"]="-"+h.toLowerCase()+"-transform"}i=document.createElement("img");document.body.insertBefore(i,null);for(o in r){n=r[o];if(i.style[o]===void 0){continue}i.style[o]="rotate(90deg)";a=window.getComputedStyle(i).getPropertyValue(n);if(a!=null&&a.length&&a!=="none"){t=true;break}}document.body.removeChild(i);if(t){e=function(){return true}}else{e=function(){return false}}return e()};o=function(i){return t(i).css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})};i=function(){function i(i,e){this.disable=c(this.disable,this);this.enable=c(this.enable,this);this.getData=c(this.getData,this);this.zoomOut=c(this.zoomOut,this);this.zoomIn=c(this.zoomIn,this);this.fit=c(this.fit,this);this.center=c(this.center,this);this.rotateRight=c(this.rotateRight,this);this.rotateLeft=c(this.rotateLeft,this);this._rotate=c(this._rotate,this);this._center=c(this._center,this);this._fit=c(this._fit,this);this._zoom=c(this._zoom,this);this._drag=c(this._drag,this);this._trigger=c(this._trigger,this);this._unbind=c(this._unbind,this);this._bind=c(this._bind,this);this._start=c(this._start,this);this._unwrap=c(this._unwrap,this);this._wrap=c(this._wrap,this);var n;this.op=t.extend(true,{},h,e,t(i).data(l));this.enabled=true;this.zoomInFactor=1+this.op.zoomStep;this.zoomOutFactor=1/this.zoomInFactor;n=[0,0,0,0,0],this.width=n[0],this.height=n[1],this.left=n[2],this.top=n[3],this.angle=n[4];this.data={scale:1,angle:0,x:0,y:0,w:this.op.width,h:this.op.height};this._wrap(i);if(this.width<1||this.height<1){this._fit()&&this._center()}o(this.$el);this.$el.on(s.start,this._start)}i.prototype._wrap=function(i){var e,h,s,n,o,r,a,l,u,d;h=t(i);if(h.prop("tagName")==="IMG"){o=document.createElement("img");o.setAttribute("src",h.attr("src"));l=[o.width,o.height],a=l[0],n=l[1]}else{u=[h.width(),h.height()],a=u[0],n=u[1]}d=[a/this.op.width,n/this.op.height],this.width=d[0],this.height=d[1];e=t("<div>").addClass("guillotine-canvas");e.css({width:this.width*100+"%",height:this.height*100+"%",top:0,left:0});e=h.wrap(e).parent();r=this.op.height/this.op.width*100+"%";s=t("<div>").addClass("guillotine-window");s.css({width:"100%",height:"auto","padding-top":r});s=e.wrap(s).parent();this.$el=h;this.el=h[0];this.$canvas=e;this.canvas=e[0];this.$gllt=s;this.gllt=s[0];return this.$document=t(i.ownerDocument)};i.prototype._unwrap=function(){this.$el.removeAttr("style");this.$el.insertBefore(this.gllt);return this.$gllt.remove()};i.prototype._start=function(t){if(!(this.enabled&&d(t))){return}t.preventDefault();t.stopImmediatePropagation();this.p=n(t);return this._bind()};i.prototype._bind=function(){this.$document.on(s.move,this._drag);return this.$document.on(s.stop,this._unbind)};i.prototype._unbind=function(t){this.$document.off(s.move,this._drag);this.$document.off(s.stop,this._unbind);if(t!=null){return this._trigger("drag")}};i.prototype._trigger=function(t){if(this.op.eventOnChange!=null){this.$el.trigger(this.op.eventOnChange,[this.data,t])}if(typeof this.op.onChange==="function"){return this.op.onChange.call(this.el,this.data,t)}};i.prototype._drag=function(t){var i,e,h,s,o;t.preventDefault();t.stopImmediatePropagation();s=n(t);e=s.x-this.p.x;h=s.y-this.p.y;this.p=s;if(e!==0){e=e/this.gllt.clientWidth;if(e>0){if(e>-this.left){e=-this.left}}else{o=-(this.width+this.left-1);if(e<o){e=o}}this.left+=e;this.canvas.style.left=this.left*100+"%";this.data.x=Math.round(-this.left*this.op.width)}if(h!==0){h=h/this.gllt.clientHeight;if(h>0){if(h>-this.top){h=-this.top}}else{i=-(this.height+this.top-1);if(h<i){h=i}}this.top+=h;this.canvas.style.top=this.top*100+"%";return this.data.y=Math.round(-this.top*this.op.height)}};i.prototype._zoom=function(t){var i,e,h;if(t<=0||t===1){return}h=[this.width,this.height],e=h[0],i=h[1];if(e*t>1&&i*t>1){this.width*=t;this.height*=t;this.canvas.style.width=(this.width*100).toFixed(2)+"%";this.canvas.style.height=(this.height*100).toFixed(2)+"%";this.data.scale*=t}else{this._fit();t=this.width/e}this.left-=e*(t-1)/2;if(this.left+this.width<1){this.left=1-this.width}if(this.left>0){this.left=0}this.top-=i*(t-1)/2;if(this.top+this.height<1){this.top=1-this.height}if(this.top>0){this.top=0}this.canvas.style.left=(this.left*100).toFixed(2)+"%";this.canvas.style.top=(this.top*100).toFixed(2)+"%";this.data.x=Math.round(-this.left*this.op.width);return this.data.y=Math.round(-this.top*this.op.height)};i.prototype._fit=function(){var t,i;t=this.width;i=this.height/this.width;if(i>1){this.width=1;this.height=i}else{this.width=1/i;this.height=1}this.canvas.style.width=(this.width*100).toFixed(2)+"%";this.canvas.style.height=(this.height*100).toFixed(2)+"%";return this.data.scale*=this.width/t};i.prototype._center=function(){this.left=(1-this.width)/2;this.top=(1-this.height)/2;this.canvas.style.left=(this.left*100).toFixed(2)+"%";this.canvas.style.top=(this.top*100).toFixed(2)+"%";this.data.x=Math.round(-this.left*this.op.width);return this.data.y=Math.round(-this.top*this.op.height)};i.prototype._rotate=function(t){var i,h,s,n,o,r,a;if(!(e()&&t%90===0)){return}this.angle=(this.angle+t)%360;if(this.angle<0){this.angle=360+this.angle}if(t%180!==0){h=this.op.height/this.op.width;o=[this.height*h,this.width/h],this.width=o[0],this.height=o[1];if(this.width>=1&&this.height>=1){this.canvas.style.width=this.width*100+"%";this.canvas.style.height=this.height*100+"%"}else{this._fit()}}r=[1,1],n=r[0],s=r[1];if(this.angle%180!==0){i=this.height/this.width*h;a=[i,1/i],n=a[0],s=a[1]}this.el.style.width=n*100+"%";this.el.style.height=s*100+"%";this.el.style.left=(1-n)/2*100+"%";this.el.style.top=(1-s)/2*100+"%";this.$el.css({transform:"rotate("+this.angle+"deg)"});this._center();return this.data.angle=this.angle};i.prototype.rotateLeft=function(){return this.enabled&&(this._rotate(-90),this._trigger("rotateLeft"))};i.prototype.rotateRight=function(){return this.enabled&&(this._rotate(90),this._trigger("rotateRight"))};i.prototype.center=function(){return this.enabled&&(this._center(),this._trigger("center"))};i.prototype.fit=function(){return this.enabled&&(this._fit(),this._center(),this._trigger("fit"))};i.prototype.zoomIn=function(){return this.enabled&&(this._zoom(this.zoomInFactor),this._trigger("zoomIn"))};i.prototype.zoomOut=function(){return this.enabled&&(this._zoom(this.zoomOutFactor),this._trigger("zoomOut"))};i.prototype.getData=function(){return this.data};i.prototype.enable=function(){return this.enabled=true};i.prototype.disable=function(){return this.enabled=false};return i}();t.fn[l]=function(e){var h,n;if(typeof e!=="string"){return this.each(function(){var h;if(!t.data(this,l+"Instance")){h=new i(this,e);return t.data(this,l+"Instance",h)}})}else{switch(h=e){case"instance":return t.data(this[0],l+"Instance");case"remove":return this.each(function(){var i;i=t.data(this,l+"Instance");if(i==null){return}i._unbind();i._unwrap();i.disable();i.$el.off(s.start,i._start);return i.$el.removeData(l+"Instance")});case"getData":return(n=t.data(this[0],l+"Instance"))!=null?n["getData"].call():void 0;case"rotateLeft":case"rotateRight":case"center":case"fit":case"zoomIn":case"zoomOut":case"enable":case"disable":return this.each(function(){var i;i=t.data(this,l+"Instance");if(i==null){return}return i[h].call()})}}}}).call(this);
