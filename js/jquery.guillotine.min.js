/*
 * jQuery Guillotine Plugin v1.0.0
 * http://matiasgagliano.github.com/guillotine/
 *
 * Copyright 2014, Mat√≠as Gagliano.
 * Dual licensed under the MIT or GPLv3 licenses.
 * http://opensource.org/licenses/MIT
 * http://opensource.org/licenses/GPL-3.0
 *
 */

(function(){"use strict";var t,i,e,s,n,h,a,o,r,f,u,c=[].indexOf||function(t){for(var i=0,e=this.length;i<e;i++){if(i in this&&this[i]===t)return i}return-1},l=function(t,i){return function(){return t.apply(i,arguments)}};t=jQuery;r="guillotine";f="guillotine";n={start:"MSPointerDown."+f+" touchstart."+f+" mousedown."+f,move:"MSPointerMove."+f+" touchmove."+f+" mousemove."+f,stop:"MSPointerUp."+f+" touchend."+f+" mouseup."+f};s={width:400,height:300,zoomStep:.1,eventOnChange:null,onChange:null};o=function(t){return t.type.search("touch")>-1};a=function(){return c.call(window,"MSPointerEvent")>=0};u=function(t){if(a()||!o(t)){u=function(t){return t.which!=null&&t.which===1}}else{u=function(){var i,e;return((i=t.originalEvent)!=null?(e=i.touches)!=null?e.length:void 0:void 0)===1}}return u(t)};h=function(t){if(a()||!o(t)){h=function(t){return{x:t.pageX,y:t.pageY}}}else{h=function(t){t=t.originalEvent.touches[0];return{x:t.pageX,y:t.pageY}}}return h(t)};e=function(){var t,i,s,n,h,a,o,r,f,u;t=false;n="webkit,Moz,O,ms,Khtml".split(",");o={transform:"transform"};for(f=0,u=n.length;f<u;f++){s=n[f];o[s+"Transform"]="-"+s.toLowerCase()+"-transform"}i=document.createElement("img");document.body.insertBefore(i,null);for(a in o){h=o[a];if(i.style[a]===void 0){continue}i.style[a]="rotate(90deg)";r=window.getComputedStyle(i).getPropertyValue(h);if(r!=null&&r.length&&r!=="none"){t=true;break}}document.body.removeChild(i);if(t){e=function(){return true}}else{e=function(){return false}}return e()};i=function(){function i(i,e){this.disable=l(this.disable,this);this.enable=l(this.enable,this);this.getData=l(this.getData,this);this.zoomOut=l(this.zoomOut,this);this.zoomIn=l(this.zoomIn,this);this.fit=l(this.fit,this);this.center=l(this.center,this);this.rotateRight=l(this.rotateRight,this);this.rotateLeft=l(this.rotateLeft,this);this._transform=l(this._transform,this);this._rotate=l(this._rotate,this);this._center=l(this._center,this);this._fit=l(this._fit,this);this._zoom=l(this._zoom,this);this._drag=l(this._drag,this);this._trigger=l(this._trigger,this);this._unbind=l(this._unbind,this);this._bind=l(this._bind,this);this._start=l(this._start,this);this._unwrap=l(this._unwrap,this);this._wrap=l(this._wrap,this);this.op=t.extend(true,{},s,e,t.data(this,r));this.zoomInFactor=1+this.op.zoomStep;this.zoomOutFactor=1/this.zoomInFactor;this.enabled=true;this.angle=0;this.data={scale:1,angle:0,x:0,y:0,w:this.op.width,h:this.op.height};this._wrap(i);if(this.el.offsetWidth<this.op.width||this.el.offsetHeight<this.op.height){this._fit()&&this._center()}this.$el.on(n.start,this._start)}i.prototype._wrap=function(i){var e,s,n,h,a,o,r,f;s=t(i);if(s.prop("tagName")==="IMG"){a=document.createElement("img");a.setAttribute("src",s.attr("src"));r=[a.width,a.height],o=r[0],h=r[1]}else{f=[s.width(),s.height()],o=f[0],h=f[1]}e=t("<div>").addClass("guillotine-canvas");e.css({width:o,height:h,top:0,left:0});e=s.wrap(e).parent();n=t("<div>").addClass("guillotine-window");n.css({width:this.op.width,height:this.op.height});n=e.wrap(n).parent();this.$el=s;this.el=s[0];this.$canvas=e;this.canvas=e[0];this.$gllt=n;this.gllt=n[0];return this.$document=t(i.ownerDocument)};i.prototype._unwrap=function(){this.$el.removeAttr("style");this.$el.insertBefore(this.gllt);return this.$gllt.remove()};i.prototype._start=function(t){if(!(this.enabled&&u(t))){return}t.preventDefault();t.stopImmediatePropagation();this.p=h(t);return this._bind()};i.prototype._bind=function(){this.$document.on(n.move,this._drag);return this.$document.on(n.stop,this._unbind)};i.prototype._unbind=function(t){this.$document.off(n.move,this._drag);this.$document.off(n.stop,this._unbind);if(t!=null){return this._trigger("drag")}};i.prototype._trigger=function(t){if(this.op.eventOnChange!=null){this.$el.trigger(this.op.eventOnChange,[this.data,t])}if(typeof this.op.onChange==="function"){return this.op.onChange.call(this.el,this.data,t)}};i.prototype._drag=function(t){var i,e,s,n,a,o;t.preventDefault();t.stopImmediatePropagation();o=h(t);i=o.x-this.p.x;e=o.y-this.p.y;this.p=o;if(i!==0){n=this.canvas.offsetLeft;s=-n;if(i<0){s=this.gllt.offsetWidth-(n+this.canvas.offsetWidth)}if(Math.abs(i)>Math.abs(s)){i=s}n+=i;this.canvas.style.left=n+"px";this.data.x=-n}if(e!==0){a=this.canvas.offsetTop;s=-a;if(e<0){s=this.gllt.offsetHeight-(a+this.canvas.offsetHeight)}if(Math.abs(e)>Math.abs(s)){e=s}a+=e;this.canvas.style.top=a+"px";return this.data.y=-a}};i.prototype._zoom=function(t){var i,e,s,n,h,a,o,r,f,u,c;if(t<=0||t===1){return}f=[this.canvas.offsetWidth,this.canvas.offsetHeight],r=f[0],i=f[1];u=[r*t,i*t],a=u[0],h=u[1];if(a>this.op.width&&h>this.op.height){this.canvas.style.width=a+"px";this.canvas.style.height=h+"px";this.data.scale*=t}else{this._fit()}c=[this.canvas.offsetWidth,this.canvas.offsetHeight],n=c[0],s=c[1];o=this.canvas.offsetTop+(i-s)/2;if(o+s<this.op.height){o=this.canvas.offsetTop+(i-s)}if(o>0){o=0}e=this.canvas.offsetLeft+(r-n)/2;if(e+n<this.op.width){e=this.canvas.offsetLeft+(r-n)}if(e>0){e=0}this.canvas.style.top=o+"px";this.canvas.style.left=e+"px";this.data.x=-e;this.data.y=-o;return this._transform()};i.prototype._fit=function(){var t,i,e,s,n,h;h=[this.canvas.offsetWidth,this.canvas.offsetHeight],s=h[0],t=h[1];e=t/s;if(e>this.op.height/this.op.width){n=this.op.width;i=this.op.width*e}else{n=this.op.height/e;i=this.op.height}this.canvas.style.width=n+"px";this.canvas.style.height=i+"px";this._transform();return this.data.scale*=n/s};i.prototype._center=function(){var t,i;i=-(this.canvas.offsetHeight-this.op.height)/2;t=-(this.canvas.offsetWidth-this.op.width)/2;this.canvas.style.top=i+"px";this.canvas.style.left=t+"px";this.data.x=-t;return this.data.y=-i};i.prototype._rotate=function(t){var i,s,n,h,a;if(!(e()&&t%90===0)){return}this.angle=(this.angle+t)%360;if(this.angle<0){this.angle=360+this.angle}h=this.canvas.style.width;this.canvas.style.width=this.canvas.style.height;this.canvas.style.height=h;a=[this.canvas.offsetWidth,this.canvas.offsetHeight],n=a[0],i=a[1];s=this.angle%180===0?1:i/n;this.el.style.width=s*100+"%";this.el.style.height=100/s+"%";this._transform();if(i<this.op.height||n<this.op.width){this._fit()}this._center();return this.data.angle=this.angle};i.prototype._transform=function(){var t,i,e;t=0<(e=this.angle)&&e<270?this.canvas.offsetWidth:0;i=this.angle>90?this.canvas.offsetHeight:0;return this.$el.css({"transform-origin":"0px 0px",transform:"translate("+t+"px, "+i+"px) rotate("+this.angle+"deg)"})};i.prototype.rotateLeft=function(){return this.enabled&&(this._rotate(-90),this._trigger("rotateLeft"))};i.prototype.rotateRight=function(){return this.enabled&&(this._rotate(90),this._trigger("rotateRight"))};i.prototype.center=function(){return this.enabled&&(this._center(),this._trigger("center"))};i.prototype.fit=function(){return this.enabled&&(this._fit(),this._center(),this._trigger("fit"))};i.prototype.zoomIn=function(){return this.enabled&&(this._zoom(this.zoomInFactor),this._trigger("zoomIn"))};i.prototype.zoomOut=function(){return this.enabled&&(this._zoom(this.zoomOutFactor),this._trigger("zoomOut"))};i.prototype.getData=function(){return this.data};i.prototype.enable=function(){return this.enabled=true};i.prototype.disable=function(){return this.enabled=false};return i}();t.fn[r]=function(e){var s,h;if(typeof e!=="string"){return this.each(function(){var s;if(!t.data(this,r+"Instance")){s=new i(this,e);return t.data(this,r+"Instance",s)}})}else{switch(s=e){case"instance":return t.data(this[0],r+"Instance");case"remove":return this.each(function(){var i;i=t.data(this,r+"Instance");if(i==null){return}i._unbind();i._unwrap();i.disable();i.$el.off(n.start,i._start);return i.$el.removeData(r+"Instance")});case"getData":return(h=t.data(this[0],r+"Instance"))!=null?h["getData"].call():void 0;case"rotateLeft":case"rotateRight":case"center":case"fit":case"zoomIn":case"zoomOut":case"enable":case"disable":return this.each(function(){var i;i=t.data(this,r+"Instance");if(i==null){return}return i[s].call()})}}}}).call(this);
